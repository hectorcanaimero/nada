{"version":3,"sources":["webpack:///src/app/@pages/ofertas/search/search.component.html","webpack:///src/app/@pages/ofertas/search/search.module.ts","webpack:///src/app/@pages/ofertas/search/search.component.ts"],"names":["app","path","component","SearchComponent","seo","util","db","act","storageMap","loja","items","fill","product","message","trackBy","index","item","this","addCanonical","slug","paramMap","pipe","map","paramsMap","get","subs","subscribe","data","Search","unsubscribe","ofertas","fills","text","split","join","search","watch","items$","res","k","i","campanhaId","campanha","hostId","host","departamento","preco_regular","parcela_regular","qtd_regular","preco_clube","parcela_clube","qtd_clube","dsc_kit","cod_kit","produtos","push","tap","length","dataLayerTracking","event","searchTerm","SearchModule","forChild"],"mappings":"iWAIY,gBACI,wBACJ,Q,yBADiB,wBCM7B,MAAMA,EAAc,CAAE,CAAEC,KAAM,QAASC,UCMhC,M,MAAMC,EAWX,YACUC,EACAC,EACAC,EACAC,EACAC,GAJA,KAAAJ,MACA,KAAAC,OACA,KAAAC,KACA,KAAAC,MACA,KAAAC,aAbV,KAAAC,KAAY,GACZ,KAAAC,MAAa,GAEb,KAAAC,KAAY,GACZ,KAAAC,QAAe,GACf,KAAAC,QAAkB,GAyIlB,KAAAC,QAAU,CAACC,EAAeC,IAAcA,EAAKD,GA/H3CE,KAAKb,IAAIc,eACTD,KAAKE,KAAOF,KAAKV,IAAIa,SAASC,KAAK,OAAAC,EAAA,GAAIC,GAAaA,EAAUC,IAAI,UAClEP,KAAKQ,KAAOR,KAAKE,KAAKO,UAAUC,GAAQV,KAAKW,OAAOD,IAGtD,WACEV,KAAKb,IAAIc,eACTD,KAAKE,KAAOF,KAAKV,IAAIa,SAASC,KAAK,OAAAC,EAAA,GAAIC,GAAaA,EAAUC,IAAI,UAClEP,KAAKQ,KAAOR,KAAKE,KAAKO,UAAUC,GAAQV,KAAKW,OAAOD,IAGtD,cACMV,KAAKQ,MAAMR,KAAKQ,KAAKI,cA2D3B,OAAOV,GACL,IAAIW,EAAe,GACnB,MAAMC,EAAa,GACbC,EAAOb,EAAKc,MAAM,KAAKC,KAAK,OAC5BC,EAAShB,EAAKc,MAAM,KAAKC,KAAK,KACpCjB,KAAKT,WAAW4B,MAAM,QAAQV,UAAU,EAAGjB,WACzCQ,KAAKoB,OAASpB,KAAKX,GAAGsB,OAAOI,GAAMX,KAAK,OAAAC,EAAA,GACtCgB,IAEE,IAAK,MAAMC,KAAKD,EAEd,IAAK,MAAME,KAAKF,EAAIC,GAAGT,QACjBQ,EAAIC,GAAGT,QAAQU,GAAG/B,QAAUA,IAC9BqB,EAAU,CACRW,WAAYH,EAAIC,GAAGT,QAAQU,GAAGC,WAC9BC,SAAUJ,EAAIC,GAAGT,QAAQU,GAAGE,SAC5BC,OAAQL,EAAIC,GAAGT,QAAQU,GAAGG,OAC1BC,KAAMN,EAAIC,GAAGT,QAAQU,GAAGI,KACxBnC,KAAM6B,EAAIC,GAAGT,QAAQU,GAAG/B,KACxBoC,aAAcP,EAAIC,GAAGT,QAAQU,GAAGK,aAChC1B,KAAMmB,EAAIC,GAAGT,QAAQU,GAAGrB,KACxB2B,cAAeR,EAAIC,GAAGT,QAAQU,GAAGM,cACjCC,gBAAiBT,EAAIC,GAAGT,QAAQU,GAAGO,gBACnCC,YAAaV,EAAIC,GAAGT,QAAQU,GAAGQ,YAC/BC,YAAaX,EAAIC,GAAGT,QAAQU,GAAGS,YAC/BC,cAAeZ,EAAIC,GAAGT,QAAQU,GAAGU,cACjCC,UAAWb,EAAIC,GAAGT,QAAQU,GAAGW,UAC7BC,QAASd,EAAIC,GAAGT,QAAQU,GAAGY,QAC3BC,QAASf,EAAIC,GAAGT,QAAQU,GAAGa,QAC3BC,SAAUhB,EAAIC,IAEhBR,EAAMwB,KAAKzB,IAIjB,OAAOC,IAET,OAAAyB,EAAA,GAAKlB,IACCA,EAAImB,OAAS,GACfxC,KAAKJ,QAAU,yCAAyCsB,MACxDlB,KAAKb,IAAIsD,kBAAkB,CACzBC,MAAO,aACPC,WAAYzB,MAGdlB,KAAKb,IAAIsD,kBAAkB,CACzBC,MAAO,WACPC,WAAYzB,IAEdlB,KAAKJ,QAAU,4H,6CA1IdV,GAAe,oD,uBAAfA,EAAe,+YFjB5B,oBACI,gBACI,eACA,gBACI,sB,gBAGJ,OACA,+BAGJ,OACJ,Q,MAV2C,yCAEK,2CAAqD,0BAIzE,6BAAgB,4B,6pOESrC,KDOA,Y,MAAM0D,G,8BAAAA,I,oDAAAA,IAAY,SATd,CACP,IACA,IACA,IACA,IACA,IACA,IAAaC,SAAS9D,O,GAGnB","file":"x","sourcesContent":["<section id=\"search\" class=\"p-y-3 py-md-5\">\n    <div class=\"container\">\n        <h1 class=\"h2-responsive b-7 mb-4\" [innerHTML]=\"message\"></h1>\n        <div class=\"row mb-4\">\n            <div class=\"col-md-4 mb-4 col-lg-3\" *ngFor=\"let item of items$ | async; trackBy: trackBy\">\n                <app-product [code]=\"item\"></app-product>\n            </div>\n        </div>\n        <app-widget-ofertas [code]=\"'geral'\" [sector]=\"product.setor\" title=\"Mais ofertas\"\n            icon=\"fas fa-shopping-basket\" type=\"slug\">\n        </app-widget-ofertas>\n    </div>\n</section>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { Routes, RouterModule } from '@angular/router';\nimport { MDBBootstrapModule } from 'angular-bootstrap-md';\n\nimport { PipesModule } from '@core/pipes/pipes.module';\nimport { OfertasModule } from 'src/app/@widgets/ofertas/ofertas.module';\nimport { ProductModule } from '@sharing/product/product.module';\n\nimport { SearchComponent } from './search.component';\n\nconst app: Routes = [ { path: ':slug', component: SearchComponent } ];\n\n@NgModule({\n  declarations: [SearchComponent],\n  imports: [\n    PipesModule,\n    CommonModule,\n    ProductModule,\n    MDBBootstrapModule,\n    OfertasModule,\n    RouterModule.forChild(app)\n  ]\n})\nexport class SearchModule { }\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\n\nimport { StorageMap } from '@ngx-pwa/local-storage';\nimport { Observable, pipe, Subscription } from 'rxjs';\nimport { map, take, tap } from 'rxjs/operators';\n\nimport { SeoService } from '@core/services/seo.service';\nimport { UtilService } from '@core/services/util.service';\nimport { DataService } from '@core/services/data.service';\n\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss']\n})\nexport class SearchComponent implements OnInit {\n\n  slug: Observable<string>;\n  loja: any = [];\n  items: any = [];\n  items$: Observable<any[]>;\n  fill: any = [];\n  product: any = [];\n  message: string = '';\n\n  subs: Subscription;\n  constructor(\n    private seo: SeoService,\n    private util: UtilService,\n    private db: DataService,\n    private act: ActivatedRoute,\n    private storageMap: StorageMap\n  ) {\n    this.seo.addCanonical();\n    this.slug = this.act.paramMap.pipe(map(paramsMap => paramsMap.get('slug')));\n    this.subs = this.slug.subscribe(data => this.Search(data));\n  }\n\n  ngOnInit(): void {\n    this.seo.addCanonical();\n    this.slug = this.act.paramMap.pipe(map(paramsMap => paramsMap.get('slug')));\n    this.subs = this.slug.subscribe(data => this.Search(data));\n  }\n\n  ngOnDestroy(): void {\n    if (this.subs) this.subs.unsubscribe();\n  }\n  // Search(slug: string) {\n  //   let ofertas: any = [];\n  //   const fills: any = [];\n  //   const text = slug.split('-').join('%20');\n  //   const search = slug.split('-').join(' ');\n  //   this.storageMap.watch('Loja').subscribe(({ loja }) => {\n  //     this.subs = this.db.Search(text).subscribe(\n  //       res => {\n  //         // tslint:disable-next-line: forin\n  //         for (const k in res) {\n  //           // tslint:disable-next-line: forin\n  //           for (const i in res[k].ofertas) {\n  //             if (res[k].ofertas[i].loja === +loja){\n  //               ofertas = {\n  //                 campanhaId: res[k].ofertas[i].campanhaId,\n  //                 campanha: res[k].ofertas[i].campanha,\n  //                 hostId: res[k].ofertas[i].hostId,\n  //                 host: res[k].ofertas[i].host,\n  //                 loja: res[k].ofertas[i].loja,\n  //                 departamento: res[k].ofertas[i].departamento,\n  //                 slug: res[k].ofertas[i].slug,\n  //                 preco_regular: res[k].ofertas[i].preco_regular,\n  //                 parcela_regular: res[k].ofertas[i].parcela_regular,\n  //                 qtd_regular: res[k].ofertas[i].qtd_regular,\n  //                 preco_clube: res[k].ofertas[i].preco_clube,\n  //                 parcela_clube: res[k].ofertas[i].parcela_clube,\n  //                 qtd_clube: res[k].ofertas[i].qtd_clube,\n  //                 dsc_kit: res[k].ofertas[i].dsc_kit,\n  //                 cod_kit: res[k].ofertas[i].cod_kit,\n  //                 produtos: res[k]\n  //               };\n  //               fills.push(ofertas);\n  //             }\n  //           }\n  //         }\n  //         this.items = fills;\n  //         if (this.items.length > 0) {\n  //           this.message = `Ofertas encontradas para a sua busca \"${search}\".`;\n  //           this.seo.dataLayerTracking({\n  //             event: 'siteSearch',\n  //             searchTerm: search\n  //           });\n  //         } else {\n  //           this.seo.dataLayerTracking({\n  //             event: 'notfound',\n  //             searchTerm: search\n  //           });\n  //           this.message = 'Esse produto não está disponível no site.<br>Mas aproveite as outras ofertas que preparamos para você.';\n  //         }\n  //       },\n  //       err => {\n  //         console.log(err);\n  //       }\n  //     );\n  //   });\n  // }\n\n  Search(slug: string) {\n    let ofertas: any = [];\n    const fills: any = [];\n    const text = slug.split('-').join('%20');\n    const search = slug.split('-').join(' ');\n    this.storageMap.watch('Loja').subscribe(({ loja }) => {\n      this.items$ = this.db.Search(text).pipe(map(\n        res => {\n          // tslint:disable-next-line: forin\n          for (const k in res) {\n            // tslint:disable-next-line: forin\n            for (const i in res[k].ofertas) {\n              if (res[k].ofertas[i].loja === +loja){\n                ofertas = {\n                  campanhaId: res[k].ofertas[i].campanhaId,\n                  campanha: res[k].ofertas[i].campanha,\n                  hostId: res[k].ofertas[i].hostId,\n                  host: res[k].ofertas[i].host,\n                  loja: res[k].ofertas[i].loja,\n                  departamento: res[k].ofertas[i].departamento,\n                  slug: res[k].ofertas[i].slug,\n                  preco_regular: res[k].ofertas[i].preco_regular,\n                  parcela_regular: res[k].ofertas[i].parcela_regular,\n                  qtd_regular: res[k].ofertas[i].qtd_regular,\n                  preco_clube: res[k].ofertas[i].preco_clube,\n                  parcela_clube: res[k].ofertas[i].parcela_clube,\n                  qtd_clube: res[k].ofertas[i].qtd_clube,\n                  dsc_kit: res[k].ofertas[i].dsc_kit,\n                  cod_kit: res[k].ofertas[i].cod_kit,\n                  produtos: res[k]\n                };\n                fills.push(ofertas);\n              }\n            }\n          }\n          return fills;\n        }),\n        tap((res) => {\n          if (res.length > 0) {\n            this.message = `Ofertas encontradas para a sua busca \"${search}\".`;\n            this.seo.dataLayerTracking({\n              event: 'siteSearch',\n              searchTerm: search\n            });\n          } else {\n            this.seo.dataLayerTracking({\n              event: 'notfound',\n              searchTerm: search\n            });\n            this.message = 'Esse produto não está disponível no site.<br>Mas aproveite as outras ofertas que preparamos para você.';\n          }\n        })\n      );\n    });\n  }\n\n  trackBy = (index: number, item: any) => item[index];\n}\n"]}